var __decorate=this&&this.__decorate||function(e,t,o,s){var l,i=arguments.length,r=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,s);else for(var n=e.length-1;n>=0;n--)(l=e[n])&&(r=(i<3?l(r):i>3?l(t,o,r):l(t,o))||r);return i>3&&r&&Object.defineProperty(t,o,r),r};import{html,nothing}from"lit";import{customElement,property,query,queryAssignedElements,state}from"lit/decorators.js";import{classMap}from"lit/directives/class-map.js";import{styleMap}from"lit/directives/style-map.js";import{VscElement}from"../includes/VscElement.js";import styles from"./vscode-scrollable.styles.js";let VscodeScrollable=class extends VscElement{constructor(){super(...arguments),this.shadow=!0,this.scrolled=!1,this._isDragging=!1,this._thumbHeight=0,this._thumbY=0,this._thumbVisible=!1,this._thumbFade=!1,this._thumbActive=!1,this._scrollThumbStartY=0,this._mouseStartY=0,this._scrollbarVisible=!0,this._scrollbarTrackZ=0,this._resizeObserverCallback=()=>{this._updateScrollbar()},this._onScrollThumbMouseMoveBound=this._onScrollThumbMouseMove.bind(this),this._onScrollThumbMouseUpBound=this._onScrollThumbMouseUp.bind(this),this._onComponentMouseOverBound=this._onComponentMouseOver.bind(this),this._onComponentMouseOutBound=this._onComponentMouseOut.bind(this)}set scrollPos(e){this._scrollableContainer.scrollTop=e}get scrollPos(){return this._scrollableContainer?this._scrollableContainer.scrollTop:0}get scrollMax(){return this._scrollableContainer?this._scrollableContainer.scrollHeight:0}connectedCallback(){super.connectedCallback(),this._hostResizeObserver=new ResizeObserver(this._resizeObserverCallback),this._contentResizeObserver=new ResizeObserver(this._resizeObserverCallback),this.requestUpdate(),this.updateComplete.then((()=>{this._scrollableContainer.addEventListener("scroll",this._onScrollableContainerScroll.bind(this)),this._hostResizeObserver.observe(this),this._contentResizeObserver.observe(this._contentElement)})),this.addEventListener("mouseover",this._onComponentMouseOverBound),this.addEventListener("mouseout",this._onComponentMouseOutBound)}disconnectedCallback(){super.disconnectedCallback(),this._hostResizeObserver.unobserve(this),this._hostResizeObserver.disconnect(),this._contentResizeObserver.unobserve(this._contentElement),this._contentResizeObserver.disconnect(),this.removeEventListener("mouseover",this._onComponentMouseOverBound),this.removeEventListener("mouseout",this._onComponentMouseOutBound)}_updateScrollbar(){const e=this.getBoundingClientRect(),t=this._contentElement.getBoundingClientRect();e.height>=t.height?this._scrollbarVisible=!1:(this._scrollbarVisible=!0,this._thumbHeight=e.height*(e.height/t.height)),this.requestUpdate()}_zIndexFix(){let e=0;this._assignedElements.forEach((t=>{if("style"in t){const o=window.getComputedStyle(t).zIndex;/([0-9-])+/g.test(o)&&(e=Number(o)>e?Number(o):e)}})),this._scrollbarTrackZ=e+1,this.requestUpdate()}_onSlotChange(){this._zIndexFix()}_onScrollThumbMouseDown(e){const t=this.getBoundingClientRect(),o=this._scrollThumbElement.getBoundingClientRect();this._mouseStartY=e.screenY,this._scrollThumbStartY=o.top-t.top,this._isDragging=!0,this._thumbActive=!0,document.addEventListener("mousemove",this._onScrollThumbMouseMoveBound),document.addEventListener("mouseup",this._onScrollThumbMouseUpBound)}_onScrollThumbMouseMove(e){const t=this._scrollThumbStartY+(e.screenY-this._mouseStartY);let o=0;const s=this.getBoundingClientRect().height,l=this._scrollThumbElement.getBoundingClientRect().height,i=this._contentElement.getBoundingClientRect().height;o=t<0?0:t>s-l?s-l:t,this._thumbY=o,this._scrollableContainer.scrollTop=o/(s-l)*(i-s)}_onScrollThumbMouseUp(e){this._isDragging=!1,this._thumbActive=!1;const t=this.getBoundingClientRect(),{x:o,y:s,width:l,height:i}=t,{pageX:r,pageY:n}=e;(r>o+l||r<o||n>s+i||n<s)&&(this._thumbFade=!0,this._thumbVisible=!1),document.removeEventListener("mousemove",this._onScrollThumbMouseMoveBound),document.removeEventListener("mouseup",this._onScrollThumbMouseUpBound)}_onScrollableContainerScroll(){const e=this._scrollableContainer.scrollTop;this.scrolled=e>0;const t=this.getBoundingClientRect().height,o=this._scrollThumbElement.getBoundingClientRect().height,s=e/(this._contentElement.getBoundingClientRect().height-t);this._thumbY=s*(t-o)}_onComponentMouseOver(){this._thumbVisible=!0,this._thumbFade=!1}_onComponentMouseOut(){this._thumbActive||(this._thumbVisible=!1,this._thumbFade=!0)}render(){return html`
      <div
        class="scrollable-container"
        style="${styleMap({"user-select":this._isDragging?"none":"auto"})}"
      >
        <div class="${classMap({shadow:!0,visible:this.scrolled})}"></div>
        ${this._isDragging?html`<div class="prevent-interaction"></div>`:nothing}
        <div
          class="${classMap({"scrollbar-track":!0,hidden:!this._scrollbarVisible})}"
          style="${styleMap({"z-index":String(this._scrollbarTrackZ)})}"
        >
          <div
            class="${classMap({"scrollbar-thumb":!0,visible:this._thumbVisible,fade:this._thumbFade,active:this._thumbActive})}"
            style="${styleMap({height:`${this._thumbHeight}px`,top:`${this._thumbY}px`})}"
            @mousedown=${this._onScrollThumbMouseDown}
          ></div>
        </div>
        <div class="content">
          <slot @slotchange="${this._onSlotChange}"></slot>
        </div>
      </div>
    `}};VscodeScrollable.styles=styles,__decorate([property({type:Boolean,reflect:!0})],VscodeScrollable.prototype,"shadow",void 0),__decorate([property({type:Boolean,reflect:!0})],VscodeScrollable.prototype,"scrolled",void 0),__decorate([property({type:Number,attribute:"scroll-pos"})],VscodeScrollable.prototype,"scrollPos",null),__decorate([property({type:Number,attribute:"scroll-max"})],VscodeScrollable.prototype,"scrollMax",null),__decorate([state()],VscodeScrollable.prototype,"_isDragging",void 0),__decorate([state()],VscodeScrollable.prototype,"_thumbHeight",void 0),__decorate([state()],VscodeScrollable.prototype,"_thumbY",void 0),__decorate([state()],VscodeScrollable.prototype,"_thumbVisible",void 0),__decorate([state()],VscodeScrollable.prototype,"_thumbFade",void 0),__decorate([state()],VscodeScrollable.prototype,"_thumbActive",void 0),__decorate([query(".content")],VscodeScrollable.prototype,"_contentElement",void 0),__decorate([query(".scrollbar-thumb")],VscodeScrollable.prototype,"_scrollThumbElement",void 0),__decorate([query(".scrollable-container")],VscodeScrollable.prototype,"_scrollableContainer",void 0),__decorate([queryAssignedElements()],VscodeScrollable.prototype,"_assignedElements",void 0),VscodeScrollable=__decorate([customElement("vscode-scrollable")],VscodeScrollable);export{VscodeScrollable};