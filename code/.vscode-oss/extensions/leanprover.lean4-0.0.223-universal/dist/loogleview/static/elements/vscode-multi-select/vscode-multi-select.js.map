{"version":3,"file":"vscode-multi-select.js","sourceRoot":"","sources":["../../src/vscode-multi-select/vscode-multi-select.ts"],"names":[],"mappings":"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","sourcesContent":["import {html, LitElement, TemplateResult} from 'lit';\nimport {customElement, property, query} from 'lit/decorators.js';\nimport {classMap} from 'lit/directives/class-map.js';\nimport {repeat} from 'lit/directives/repeat.js';\nimport {chevronDownIcon} from '../includes/vscode-select/template-elements.js';\nimport {VscodeSelectBase} from '../includes/vscode-select/vscode-select-base.js';\nimport styles from './vscode-multi-select.styles.js';\nimport {AssociatedFormControl} from '../includes/AssociatedFormControl.js';\nimport {highlightRanges} from '../includes/vscode-select/helpers.js';\n\n/**\n * Allows to select multiple items from a list of options.\n *\n * When participating in a form, it supports the `:invalid` pseudo class. Otherwise the error styles\n * can be applied through the `invalid` property.\n *\n * @prop {boolean} invalid\n * @attr {boolean} invalid\n * @attr name - Name which is used as a variable name in the data of the form-container.\n *\n * @cssprop [--dropdown-z-index=2]\n * @cssprop --vscode-badge-background\n * @cssprop --vscode-badge-foreground\n * @cssprop --vscode-settings-dropdownBorder\n * @cssprop --vscode-settings-checkboxBackground\n * @cssprop --vscode-settings-dropdownBackground\n * @cssprop --vscode-settings-dropdownListBorder\n * @cssprop --vscode-focusBorder\n * @cssprop --vscode-foreground\n * @cssprop --vscode-font-family\n * @cssprop --vscode-font-size\n * @cssprop --vscode-font-weight\n * @cssprop --vscode-list-activeSelectionBackground\n * @cssprop --vscode-list-activeSelectionForeground\n * @cssprop --vscode-list-focusOutline\n * @cssprop --vscode-list-focusHighlightForeground\n * @cssprop --vscode-list-highlightForeground\n * @cssprop --vscode-list-hoverBackground\n * @cssprop --vscode-list-hoverForeground\n * @cssprop --vscode-list-hoverBackground\n * @cssprop --vscode-settings-textInputBackground\n * @cssprop --vscode-list-hoverBackground\n */\n@customElement('vscode-multi-select')\nexport class VscodeMultiSelect\n  extends VscodeSelectBase\n  implements AssociatedFormControl\n{\n  static styles = styles;\n\n  /** @internal */\n  static override shadowRootOptions: ShadowRootInit = {\n    ...LitElement.shadowRootOptions,\n    delegatesFocus: true,\n  };\n\n  static formAssociated = true;\n\n  @property({type: Array, attribute: 'default-value'})\n  defaultValue: string[] = [];\n\n  @property({type: Boolean, reflect: true})\n  required = false;\n\n  @property({reflect: true})\n  name: string | undefined = undefined;\n\n  @property({type: Array, attribute: false})\n  set selectedIndexes(val: number[]) {\n    this._selectedIndexes = val;\n  }\n  get selectedIndexes(): number[] {\n    return this._selectedIndexes;\n  }\n\n  @property({type: Array})\n  set value(val: string[]) {\n    const sanitizedVal = val.map((v) => String(v));\n    this._values = sanitizedVal;\n\n    this._selectedIndexes.forEach((i) => {\n      this._options[i].selected = false;\n    });\n\n    this._selectedIndexes = [];\n\n    sanitizedVal.forEach((v) => {\n      if (this._valueOptionIndexMap[v]) {\n        this._selectedIndexes.push(this._valueOptionIndexMap[v]);\n        this._options[this._valueOptionIndexMap[v]].selected = true;\n      }\n    });\n\n    this._setFormValue();\n    this._manageRequired();\n  }\n  get value(): string[] {\n    return this._values;\n  }\n\n  get form() {\n    return this._internals.form;\n  }\n\n  /** @internal */\n  get type() {\n    return 'select-multiple';\n  }\n\n  get validity(): ValidityState {\n    return this._internals.validity;\n  }\n\n  get validationMessage(): string {\n    return this._internals.validationMessage;\n  }\n\n  get willValidate() {\n    return this._internals.willValidate;\n  }\n\n  checkValidity(): boolean {\n    return this._internals.checkValidity();\n  }\n\n  reportValidity(): boolean {\n    return this._internals.reportValidity();\n  }\n\n  private _internals: ElementInternals;\n\n  constructor() {\n    super();\n    /** @internal */\n    this._multiple = true;\n    this._internals = this.attachInternals();\n  }\n\n  connectedCallback(): void {\n    super.connectedCallback();\n\n    this.updateComplete.then(() => {\n      this._setDefaultValue();\n      this._manageRequired();\n    });\n  }\n\n  /** @internal */\n  formResetCallback(): void {\n    this.updateComplete.then(() => {\n      this.value = this.defaultValue;\n    });\n  }\n\n  /** @internal */\n  formStateRestoreCallback(\n    state: FormData,\n    _mode: 'restore' | 'autocomplete'\n  ): void {\n    const entries = Array.from(state.entries()).map((e) => String(e[1]));\n\n    this.updateComplete.then(() => {\n      this.value = entries;\n    });\n  }\n\n  @query('.face')\n  private _faceElement!: HTMLDivElement;\n\n  private _setDefaultValue() {\n    if (Array.isArray(this.defaultValue) && this.defaultValue.length > 0) {\n      const val = this.defaultValue.map((v) => String(v));\n      this.value = val;\n    }\n  }\n\n  private _manageRequired() {\n    const {value} = this;\n    if (value.length === 0 && this.required) {\n      this._internals.setValidity(\n        {\n          valueMissing: true,\n        },\n        'Please select an item in the list.',\n        this._faceElement\n      );\n    } else {\n      this._internals.setValidity({});\n    }\n  }\n\n  private _setFormValue() {\n    const fd = new FormData();\n\n    this._values.forEach((v) => {\n      fd.append(this.name ?? '', v);\n    });\n\n    this._internals.setFormValue(fd);\n  }\n\n  private _onOptionClick(ev: MouseEvent) {\n    const composedPath = ev.composedPath();\n    const optEl = composedPath.find((et) => {\n      if ('matches' in et) {\n        return (et as HTMLElement).matches('li.option');\n      }\n\n      return false;\n    });\n\n    if (!optEl) {\n      return;\n    }\n\n    const index = Number((optEl as HTMLElement).dataset.index);\n\n    if (this._options[index]) {\n      this._options[index].selected = !this._options[index].selected;\n    }\n\n    this._selectedIndexes = [];\n    this._values = [];\n\n    this._options.forEach((op) => {\n      if (op.selected) {\n        this._selectedIndexes.push(op.index);\n        this._values.push(op.value);\n      }\n    });\n\n    this._setFormValue();\n    this._manageRequired();\n    this._dispatchChangeEvent();\n  }\n\n  private _onMultiAcceptClick(): void {\n    this._toggleDropdown(false);\n  }\n\n  private _onMultiDeselectAllClick(): void {\n    this._selectedIndexes = [];\n    this._values = [];\n    this._options = this._options.map((op) => ({...op, selected: false}));\n    this._manageRequired();\n    this._dispatchChangeEvent();\n  }\n\n  private _onMultiSelectAllClick(): void {\n    this._selectedIndexes = [];\n    this._values = [];\n    this._options = this._options.map((op) => ({...op, selected: true}));\n    this._options.forEach((op, index) => {\n      this._selectedIndexes.push(index);\n      this._values.push(op.value);\n      this._dispatchChangeEvent();\n    });\n\n    this._setFormValue();\n    this._manageRequired();\n  }\n\n  private _renderLabel() {\n    switch (this._selectedIndexes.length) {\n      case 0:\n        return html`<span class=\"select-face-badge no-item\"\n          >No items selected</span\n        >`;\n      case 1:\n        return html`<span class=\"select-face-badge\">1 item selected</span>`;\n      default:\n        return html`<span class=\"select-face-badge\"\n          >${this._selectedIndexes.length} items selected</span\n        >`;\n    }\n  }\n\n  protected _renderSelectFace(): TemplateResult {\n    return html`\n      <div\n        class=\"select-face face multiselect\"\n        @click=\"${this._onFaceClick}\"\n        tabindex=\"${this.tabIndex > -1 ? 0 : -1}\"\n      >\n        ${this._renderLabel()} ${chevronDownIcon}\n      </div>\n    `;\n  }\n\n  protected _renderComboboxFace(): TemplateResult {\n    const inputVal =\n      this._selectedIndex > -1 ? this._options[this._selectedIndex].label : '';\n\n    return html`\n      <div class=\"combobox-face face\">\n        ${this._renderLabel()}\n        <input\n          class=\"combobox-input\"\n          spellcheck=\"false\"\n          type=\"text\"\n          .value=\"${inputVal}\"\n          @focus=\"${this._onComboboxInputFocus}\"\n          @input=\"${this._onComboboxInputInput}\"\n          @click=\"${this._onComboboxInputClick}\"\n        />\n        <button\n          class=\"combobox-button\"\n          type=\"button\"\n          @click=\"${this._onComboboxButtonClick}\"\n          @keydown=\"${this._onComboboxButtonKeyDown}\"\n        >\n          ${chevronDownIcon}\n        </button>\n      </div>\n    `;\n  }\n\n  protected _renderOptions(): TemplateResult {\n    const list = this.combobox ? this._filteredOptions : this._options;\n\n    return html`\n      <ul\n        class=\"options\"\n        @click=\"${this._onOptionClick}\"\n        @mouseover=\"${this._onOptionMouseOver}\"\n      >\n        ${repeat(\n          list,\n          (op) => op.index,\n          (op, index) => {\n            const selected = this._selectedIndexes.includes(op.index);\n            const optionClasses = classMap({\n              active: index === this._activeIndex,\n              option: true,\n              selected,\n            });\n            const checkboxClasses = classMap({\n              'checkbox-icon': true,\n              checked: selected,\n            });\n\n            return html`\n              <li\n                class=\"${optionClasses}\"\n                data-index=\"${op.index}\"\n                data-filtered-index=\"${index}\"\n              >\n                <span class=\"${checkboxClasses}\"></span>\n                <span class=\"option-label\"\n                  >${(op.ranges?.length ?? 0 > 0)\n                    ? highlightRanges(op.label, op.ranges ?? [])\n                    : op.label}</span\n                >\n              </li>\n            `;\n          }\n        )}\n      </ul>\n    `;\n  }\n\n  protected _renderDropdownControls(): TemplateResult {\n    return html`\n      <div class=\"dropdown-controls\">\n        <button\n          type=\"button\"\n          @click=\"${this._onMultiSelectAllClick}\"\n          title=\"Select all\"\n          class=\"action-icon\"\n          id=\"select-all\"\n        >\n          <vscode-icon name=\"checklist\"></vscode-icon>\n        </button>\n        <button\n          type=\"button\"\n          @click=\"${this._onMultiDeselectAllClick}\"\n          title=\"Deselect all\"\n          class=\"action-icon\"\n          id=\"select-none\"\n        >\n          <vscode-icon name=\"clear-all\"></vscode-icon>\n        </button>\n        <vscode-button\n          class=\"button-accept\"\n          @click=\"${this._onMultiAcceptClick}\"\n          >OK</vscode-button\n        >\n      </div>\n    `;\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'vscode-multi-select': VscodeMultiSelect;\n  }\n}\n"]}