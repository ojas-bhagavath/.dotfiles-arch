var __decorate=this&&this.__decorate||function(e,t,s,n){var o,i=arguments.length,c=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,s,n);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(c=(i<3?o(c):i>3?o(t,s,c):o(t,s))||c);return i>3&&c&&Object.defineProperty(t,s,c),c};import{html,nothing}from"lit";import{customElement,property,query,state}from"lit/decorators.js";import{VscElement}from"../includes/VscElement.js";import"../vscode-context-menu-item";import styles from"./vscode-context-menu.styles.js";let VscodeContextMenu=class extends VscElement{set data(e){this._data=e;const t=[];e.forEach(((e,s)=>{e.separator||t.push(s)})),this._clickableItemIndexes=t}get data(){return this._data}set show(e){this._show=e,this._selectedClickableItemIndex=-1,e&&this.updateComplete.then((()=>{this._wrapperEl&&this._wrapperEl.focus(),requestAnimationFrame((()=>{document.addEventListener("click",this._onClickOutsideBound,{once:!0})}))}))}get show(){return this._show}constructor(){super(),this.tabIndex=0,this._selectedClickableItemIndex=-1,this._show=!1,this._data=[],this._clickableItemIndexes=[],this._onClickOutsideBound=this._onClickOutside.bind(this),this.addEventListener("keydown",this._onKeyDown)}_onClickOutside(e){e.composedPath().includes(this)||(this._show=!1)}_onKeyDown(e){const{key:t}=e;switch("ArrowUp"!==t&&"ArrowDown"!==t&&"Escape"!==t&&"Enter"!==t||e.preventDefault(),t){case"ArrowUp":this._handleArrowUp();break;case"ArrowDown":this._handleArrowDown();break;case"Escape":this._handleEscape();break;case"Enter":this._handleEnter()}}_handleArrowUp(){0===this._selectedClickableItemIndex?this._selectedClickableItemIndex=this._clickableItemIndexes.length-1:this._selectedClickableItemIndex-=1}_handleArrowDown(){this._selectedClickableItemIndex+1<this._clickableItemIndexes.length?this._selectedClickableItemIndex+=1:this._selectedClickableItemIndex=0}_handleEscape(){this._show=!1,document.removeEventListener("click",this._onClickOutsideBound)}_dispatchSelectEvent(e){const{keybinding:t,label:s,value:n,separator:o,tabindex:i}=e;this.dispatchEvent(new CustomEvent("vsc-context-menu-select",{detail:{keybinding:t,label:s,separator:o,tabindex:i,value:n}}))}_dispatchLegacySelectEvent(e){const{keybinding:t,label:s,value:n,separator:o,tabindex:i}=e,c={keybinding:t,label:s,value:n,separator:o,tabindex:i};this.dispatchEvent(new CustomEvent("vsc-select",{detail:c,bubbles:!0,composed:!0}))}_handleEnter(){if(-1===this._selectedClickableItemIndex)return;const e=this._clickableItemIndexes[this._selectedClickableItemIndex],t=this._wrapperEl.querySelectorAll("vscode-context-menu-item")[e];this._dispatchLegacySelectEvent(t),this._dispatchSelectEvent(t),this._show=!1,document.removeEventListener("click",this._onClickOutsideBound)}_onItemClick(e){const t=e.currentTarget;this._dispatchLegacySelectEvent(t),this._dispatchSelectEvent(t),this._show=!1}_onItemMouseOver(e){const t=e.target,s=t.dataset.index?+t.dataset.index:-1,n=this._clickableItemIndexes.findIndex((e=>e===s));-1!==n&&(this._selectedClickableItemIndex=n)}_onItemMouseOut(){this._selectedClickableItemIndex=-1}render(){if(!this._show)return html`${nothing}`;const e=this._clickableItemIndexes[this._selectedClickableItemIndex];return html`
      <div class="context-menu" tabindex="0">
        ${this.data?this.data.map((({label:t="",keybinding:s="",value:n="",separator:o=!1,tabindex:i=0},c)=>html`
                <vscode-context-menu-item
                  label="${t}"
                  keybinding="${s}"
                  value="${n}"
                  ?separator="${o}"
                  ?selected="${c===e}"
                  tabindex="${i}"
                  @vsc-click="${this._onItemClick}"
                  @mouseover=${this._onItemMouseOver}
                  @mouseout=${this._onItemMouseOut}
                  data-index=${c}
                ></vscode-context-menu-item>
              `)):html`<slot></slot>`}
      </div>
    `}};VscodeContextMenu.styles=styles,__decorate([property({type:Array,attribute:!1})],VscodeContextMenu.prototype,"data",null),__decorate([property({type:Boolean,reflect:!0})],VscodeContextMenu.prototype,"show",null),__decorate([property({type:Number,reflect:!0})],VscodeContextMenu.prototype,"tabIndex",void 0),__decorate([state()],VscodeContextMenu.prototype,"_selectedClickableItemIndex",void 0),__decorate([state()],VscodeContextMenu.prototype,"_show",void 0),__decorate([query(".context-menu")],VscodeContextMenu.prototype,"_wrapperEl",void 0),VscodeContextMenu=__decorate([customElement("vscode-context-menu")],VscodeContextMenu);export{VscodeContextMenu};